extends layout

block content
    script(src=chatUrl+'socket.io/socket.io.js')
    script(type="application/lua").
        print("hello bot!")
    script.
            let mobiles = ['bet_total_stats', 'bet_current_stats', 'bet_current_stats2', 'bet_datatable', 'misc_items_form', 'user_info_form'];
            let stopOnWin = false, stopOnLoss = false, iswin = false;
            let minBetAmount = 0.00000001, currencyValue = 0, betAmount = 0;
            let count = 1, errCount = 1;
            let intervalID, buttonStatus;
            let format = webix.Date.dateToStr("%H:%i:%s");
            let nums = 0, currency = 'btc', base = 0, isloop = false, currentLanguage = 'lua';
            let autoLossRadio, autoWinRadio;
            let code;
            let basebet = 0, nextbet = 0, chance = 0, bethigh = false;
            let previousbet = 0, win = false, currentprofit = 0, balance = 0, bets = 0, wins = 0, losses = 0, profit = 0, currentstreak = 0, currentroll = 0 ;
            let humps = ['baseBet', 'nextBet', 'betHigh', 'previousBet', 'currentProfit', 'currentStreak','currentRoll'];
            let maxwinstreak = 0, maxlossstreak = 0, maxwinstreakamount = 0, maxlossstreakamount = 0, maxstreakamount = 0, minstreakamount = 0 ;
            var dataProxy = webix.proxy("socketio", "/comments", {
              client: io('#{chatUrl}',{transports: ['websocket']}),
              clientId: webix.uid(),
              load:function(view){
                view = view.queryView("list");
                webix.proxy.socketio.load.call(this, view);
              }
            });
            var bet_total_stats = {
                id: "bet_total_stats",
                view: "property",
                elements: [
                    {label: "TOTAL STATS", type: "label"},
                    {label: "BALANCE", id: "bet_total_stats_balance", value:"0", type: "text"},
                    {label: "WIN", type: "text", id: "bet_total_stats_win", value:"0"},
                    {label: "LOSS", type: "text", id: "bet_total_stats_loss", value:"0"},
                    {label: "BET", type: "text", id: "bet_total_stats_bet", value:"0"},
                    {label: "PROFIT", type: "text", id: "bet_total_stats_profit", value:"0"},
                    {label: "WAGERED", type: "text", id: "bet_total_stats_wagered", value:"0"},
                ]
            };
            var bet_current_stats = {
                id: "bet_current_stats",
                view: "property",
                elements: [
                    {label: "CURRENT STATS 1", type: "label"},
                    {label: "BALANCE", type: "text", id: "bet_current_stats_balance", value:"0"},
                    {label: "WIN", type: "text", id: "bet_current_stats_win", value:"0"},
                    {label: "LOSS", type: "text", id: "bet_current_stats_loss", value:"0"},
                    {label: "BET", type: "text", id: "bet_current_stats_bet", value:"0"},
                    {label: "PROFIT", type: "text", id: "bet_current_stats_profit", value:"0"},
                    {label: "WAGERED", type: "text", id: "bet_current_stats_wagered", value:"0"},
                ]
            };
            var bet_current_stats2 = {
                id: "bet_current_stats2",
                view: "property",
                nameWidth: 120,
                elements: [
                    {label: "CURRENT STATS 2", type: "label"},
                    {label: "current streak", type: "text", id: "bet_current_stats_current_streak", value:"0"},
                    {label: "max win streak", type: "text", id: "bet_current_stats_max_win_streak", value:"0"},
                    {label: "max loss streak", type: "text", id: "bet_current_stats_max_loss_streak", value:"0"},
                    {label: "max lostrk amnt", type: "text", id: "bet_current_stats_max_loss_streak_amount", value:"0"},
                    {label: "max bet amnt", type: "text", id: "bet_current_stats_max_bet_amount", value:"0", },
                ]
            };
            var bet_currency_selection = {
                id: "bet_currency_selection",
                options: [
                    {id:1,value:"BTC"},
                    {id:2,value:"Doge"},
                    {id:3,value:"LTC"},
                    {id:4,value:"ETH"}
                ],
                view: "richselect",
                left: 70,
                top: 70,
                value: 1,
                label: "CURRENCY",
                labelWidth: 90,
                placeholder: "BTC",
                name: "currency"
            };
            var bet_house_edge_selection = {
                id: "bet_house_edge_selection",
                options: [
                    {id:0.001,value:"0.1%"},
                    {id:0.002,value:"0.2%"},
                    {id:0.005,value:"0.5%"},
                    {id:0.01,value:"1%"},
                    {id:0.015,value:"1.5%"},
                    {id:0.02,value:"2%"},
                ],
                view: "richselect",
                left: 70,
                top: 70,
                value: 0.01,
                label: "HOUSEEDGE",
                labelWidth: 90,
                placeholder: "0.1%",
                name: "house_edge",
                hidden: true,
            };
            var reset_session_button = {
                id: "reset_session_button",
                view: "button",
                label: "RESET SESSION",
                css: "webix_primary",
            };
            var switch_site_button = {
                id: "switch_site_button",
                view: "button",
                type: "danger",
                label: "SWITCH SITE",
                css: "webix_danger",
            };
            var dice_site_ref_list = [
                "<a target='_blank' href='https://www.999dice.com/?224280708'>999Dice-0.1% House</a>",
                "<a target='_blank' href='https://www.bitsler.com/?ref=mydicebot'>Bitsler-1% House</a>",
                "<a target='_blank' href='https://www.crypto-games.net/?i=CpQP3V8Up2'>CryptoGames-0.8% House</a>",
                "<a target='_blank' href='https://magic-dice.com/?ref=mydicebot'>MagicDice-2% House</a>",
                "<a target='_blank' href='https://primedice.com/?c=mydicebot'>PrimeDice-1% House</a>",
                "<a target='_blank' href='https://stake.com/?code=mydicebot'>Stake-2% House</a>",
                "<a target='_blank' href='https://yolodice.com/r?6fAf-wVz'>YoloDice-1% House</a>",
                "<a target='_blank' href='https://epicdice.io/?ref=mydicebot'>EpicDice-2% House</a>",
                "<a target='_blank' href='https://steem-bet.com?ref=mydicebot'>SteemBet-2% House</a>",
            ];
            var dice_site_ref_info = {
                id: "dice_site_ref_info",
                paddingY: 10,
                rows: [{
                    view: "label",
                    label: dice_site_ref_list[Math.floor(Math.random() * dice_site_ref_list.length)]
                }]
            };
            var user_login_logout_button = {
                id: "user_login_logout_button",
                view: "button",
                height: 100,
                type: "imageTop",
                image:"../images/guest.png",
                label: "click to login"
            };
            var user_info_stats = {
                id: "user_info_stats",
                view: "property",
                elements: [
                    {label: "UID", type: "text", id: "user_id", },
                    {label: "NAME", type: "text", id: "user_name", },
                ]
            };
            var bet_chart = {
                id: "bet_chart",
                view: "chart",
                type: "spline",
                value: "#yValue#",
                cellWidth: 10,
                dynamic: true,
                label: function (obj) {
                    return parseInt(obj.yValue, 10);
                },
                item: {
                    borderColor: "#1293f8",
                    color: "#ffffff"
                },
                line: {
                    color: "#1293f8",
                    width: 3
                },
                xAxis: {
                    template: "#xValue#"
                },
                yAxis: {},
                series: [
                    {
                        value: "#yValue#",
                        item: {
                            borderColor: "#1293f8",
                            color: "#ffffff"
                        },
                        line: {
                            color: "#1293f8",
                            width: 2
                        },
                        tooltip: {
                            template: "#yValue#"
                        }
                    }
                ]
            };
            var bet_datatable;
            if(!webix.env.mobile) {
                bet_datatable = {
                    id: "bet_datatable",
                    view: "datatable",
                    columns: [
                        {id: "bet_datatable_id", header: ["ID",{content:"textFilter"}], fillspace:true},
                        {id: "bet_datatable_bet_chance", header: ["GAME",{content:"textFilter"}], fillspace:true},
                        {id: "bet_datatable_actual_chance", header: ["ROLL",{content:"textFilter"}], fillspace:true,sort:"int"},
                        {id: "bet_datatable_amount", header: ["AMOUNT",{content:"textFilter"}], fillspace:true,sort:"int"},
                        {id: "bet_datatable_payout", header: ["PAYOUT",{content:"textFilter"}], fillspace:true,sort:"int"},
                        {id: "bet_datatable_profit", header: ["PROFIT",{content:"textFilter"}], fillspace:true,sort:"int"}
                    ]
                };
            } else {
                bet_datatable = {
                    id: "bet_datatable",
                    view: "datatable",
                    columns: [
                        {id: "bet_datatable_id", header: ["ID"], fillspace:true},
                        {id: "bet_datatable_bet_chance", header: ["GAME"], fillspace:true},
                        {id: "bet_datatable_actual_chance", header: ["ROLL"], fillspace:true},
                        {id: "bet_datatable_amount", header: ["AMOUNT"], fillspace:true},
                        {id: "bet_datatable_payout", header: ["PAYOUT"], fillspace:true},
                        {id: "bet_datatable_profit", header: ["PROFIT",], fillspace:true}
                    ]
                };
            }
            var bet_config_tabview = {
                id: "bet_config_tabview",
                view: "tabview",
                tabbar:{
                    optionWidth:70
                },
                width: 400,
                cells: [
                    {
                      header: "CHAT",
                      body: {
                        view:"comments",
                        id:"chat",
                        width: 0,
                        minHeight: 300,
                        url:  dataProxy,
                        save: dataProxy
                      }
                    },
                    {
                        header: "MANUAL",
                        body: {
                            id: "manual_bet_form",
                            view: "form",
                            paddingY: 4,
                            margin: 0,
                            minHeight: 500,
                            height: 0,
                            width: 0,
                            elements: [
                                {
                                    id: "manual_bet_amount",
                                    view: "text",
                                    label: "BET AMOUNT",
                                    value: "0.00000001",
                                    labelWidth: 200,
                                    name: "manual_bet_amount"
                                },
                                {
                                    cols: [
                                        {
                                            id: "manual_bet_amount_min_button",
                                            view: "button",
                                            label: "MIN",
                                            css: "webix_secondary",
                                        },
                                        {
                                            id: "manual_bet_amount_max_button",
                                            view: "button",
                                            label: "MAX",
                                            css: "webix_secondary",
                                        },
                                        {
                                            id: "manual_bet_amount_half_button",
                                            view: "button",
                                            label: "1/2",
                                            css: "webix_secondary",
                                        },
                                        {
                                            id: "manual_bet_amount_double_button",
                                            view: "button",
                                            label: "2x",
                                            css: "webix_secondary",
                                        },
                                    ]
                                },
                                {
                                    id: "manual_bet_chance",
                                    view: "text",
                                    label: "BET CHANCE",
                                    value: "49.50",
                                    labelWidth: 200,
                                    name: "manual_bet_chance"
                                },
                                {
                                    id: "manual_bet_low_button",
                                    view: "button",
                                    type: "form",
                                    label: "BET LOW",
                                    css: "webix_primary",
                                },
                                {
                                    id: "manual_bet_high_button",
                                    view: "button",
                                    type: "form",
                                    label: "BET HIGH",
                                    css: "webix_primary",
                                }
                            ]
                        }
                    },
                    {
                        header: "AUTO",
                        body: {
                            rows: [
                            {
                            id: "auto_bet_form",
                            view: "form",
                            paddingY: 4,
                            margin: 0,
                            height: 0,
                            width: 0,
                            scroll:true,
                            elements: [
                                {
                                    id: "auto_bet_number_of_bets",
                                    view: "text",
                                    label: "NUM OF BETS(0:UNLIMITED)",
                                    labelWidth: 240,
                                    value: "0"
                                },
                                {
                                    id: "auto_bet_start_low_high",
                                    view: "richselect",
                                    label: "START(LOW/HIGH)",
                                    labelWidth: 240,
                                    value: "LOW",
                                    options: ["LOW", "HIGH"]
                                },
                                {
                                    id: "auto_bet_base_amount",
                                    view: "text",
                                    label: "BET BASE AMOUNT",
                                    value: "0.00000001",
                                    labelWidth: 240,
                                    name: "auto_bet_base_amount"
                                },
                                {
                                    cols:[
                                        {
                                            id: "auto_bet_amount_radio_on_loss",
                                            label: "ON LOSS",
                                            view: "radio",
                                            value: "RESET TO BASE AMOUNT",
                                            options: [
                                                {value: "RESET TO BASE AMOUNT"}, 
                                                {value: "MULTIPLIER", newline:true}
                                            ]
                                        },
                                        {
                                            rows:[
                                                {view: "label"},
                                                {
                                                    id: "auto_bet_amount_radio_on_loss_multiplier",
                                                    view: "text",
                                                    width: 60,
                                                    value: "2"
                                                }

                                            ]
                                        }
                                    ]

                                },
                                {
                                    cols:[
                                        {
                                            id: "auto_bet_amount_radio_on_win",
                                            label: "ON WIN",
                                            view: "radio",
                                            value: "RESET TO BASE AMOUNT",
                                            options: [
                                                {value:"RESET TO BASE AMOUNT"}, 
                                                {value:"MULTIPLIER", newline:true}
                                            ]
                                        },
                                        {
                                            rows: [
                                                {view: "label"},
                                                {
                                                    id: "auto_bet_amount_radio_on_win_multiplier",
                                                    view: "text",
                                                    width: 60,
                                                    value: "2"
                                                }
                                            ]
                                        }
                                    ]
                                },
                                {
                                    id: "auto_bet_base_chance",
                                    view: "text",
                                    label: "BET BASE CHANCE",
                                    value: "49.50",
                                    labelWidth: 240,
                                    name: "auto_bet_base_chance"
                                },
                                {
                                    cols:[
                                        {
                                            id: "auto_bet_stop_on_roll",
                                            label: "STOP ON ROLL",
                                            view: "label",
                                            labelWidth: 150,
                                            name: "auto_bet_stop_on_roll"
                                        },
                                        {
                                            id: "auto_bet_roll_min",
                                            label: "MIN",
                                            view: "text",
                                            labelWidth: 40,
                                            width: 100,
                                            value: "0.00",
                                            name: "auto_bet_roll_min"
                                        },
                                        {
                                            id: "auto_bet_roll_max",
                                            label: " -- MAX",
                                            view: "text",
                                            labelWidth: 60,
                                            width: 120,
                                            value: "0.00",
                                            name: "auto_bet_roll_max"
                                        }
                                    ]
                                },
                                {
                                    id: "auto_bet_stop_on_profit",
                                    view: "text",
                                    label: "STOP ON PROFIT(0:NON-STOP)",
                                    labelWidth: 230,
                                    value: "0.00000000",
                                    name: "auto_bet_stop_on_profit"
                                },
                                {
                                    id: "auto_bet_stop_on_win",
                                    view: "text",
                                    label: "STOP ON WIN(0:NON-STOP)",
                                    labelWidth: 230,
                                    value: "0",
                                    name: "auto_bet_stop_on_win"
                                },
                                {
                                    id: "auto_bet_stop_on_loss",
                                    view: "text",
                                    label: "STOP ON LOSS(0:NON-STOP)",
                                    labelWidth: 230,
                                    value: "0",
                                    name: "auto_bet_stop_on_loss"
                                },
                            ]
                        },
                        {
                            id: "auto_bet_form_start_stop_buttons",
                            view: "form",
                            paddingY: 1,
                            margin: 0,
                            minHeight: 70,
                            width: 0,
                            elements: [
                                {
                                    id: "auto_bet_start_stop_button",
                                    view: "button",
                                    type: "form",
                                    label: "START",
                                    css: "webix_primary",
                                    value: "START"
                                },
                                {
                                    id: "auto_bet_stop_on_next_win_button",
                                    view: "button",
                                    css: "webix_secondary",
                                    type: "form",
                                    label: "STOP ON NEXT WIN"
                                },
                                {
                                    id: "auto_bet_stop_on_next_loss_button",
                                    view: "button",
                                    css: "webix_secondary",
                                    type: "form",
                                    label: "STOP ON NEXT LOSS"
                                },
                            ]}
                        ]} 
                    },
                    {
                        header: "SCRIPT",
                        body: {
                            id: "script_bet_form",
                            view: "form",
                            paddingY: 4,
                            margin: 0,
                            height: 0,
                            width: 0,
                            elements: [
                                {cols: [
                                {
                                    id: "script_bet_menu",
                                    view:"menu",
                                    width: 80,
                                    data:[
                                        { id:"1",value:"MENU", submenu:[
                                            "Import",
                                            "Save", 
                                            "Save As..",
                                            "Delete"
                                        ]}
                                    ],
                                    openAction:"click",
                                    on:{
                                        onMenuItemClick:function(id){
                                            if(this.getMenuItem(id).value == 'Save') {
                                                saveScript($$("script_code_name").getValue());
                                            } else if (this.getMenuItem(id).value == 'Import') {
                                                $$("uploadScript").fileDialog();
                                            } else if (this.getMenuItem(id).value == 'Save As..') {
                                                $$('script_code').show();
                                            } else if (this.getMenuItem(id).value == 'Delete') {
                                                delScript($$("script_code_name").getValue());
                                            }
                                        }
                                    },
                                    type:{
                                        subsign:true
                                    }
                                },
                                {
                                    options: [
                                    ],
                                    view: "richselect",
                                    value: "Untitled.lua",
                                    placeholder: "Untitled.lua",
                                    id: "script_bet_strategy_list",
                                    name: "script_bet_strategy_list"
                                },
                                ]},
                                { view:"radio", id:"script_language_radio",  name:"script_language_radio", label:"Script", value:"lua",  options:["lua", "javascript"]},
                                {
                                    id: "script_bet_tabview",
                                    view: "tabview",
                                    height: 0,
                                    cells: [
                                        {
                                            header: "CODE",
                                            body: {
                                                view:"fullscreenlayout",
                                                cells:[
                                                    {
                                                        id: "script_bet_coding_board",
                                                        view: "codemirror-editor",
                                                        mode: "lua",
                                                        theme: "#{codeSkin}",
                                                        height:0,
                                                        relative:true
                                                    },
                                                    {
                                                        id:"script_expand_button",
                                                        view: "button",
                                                        css:{"z-index": 10},
                                                        type: "image",
                                                        image:"../images/expand.png",
                                                        bottom: 20,
                                                        right: 35,
                                                        width: 25,
                                                        height: 25,
                                                        click: expand,
                                                     },
                                                     {
                                                        id:"script_save_button",
                                                        view: "button",
                                                        css:{"z-index": 10 },
                                                        type: "image",
                                                        image:"../images/save.png",
                                                        bottom: 60,
                                                        right: 35,
                                                        width: 25,
                                                        height: 25,
                                                        click: "saveScript($$('script_code_name').getValue());",
                                                     }
                                                ]
                                            }
                                        },
                                        {
                                            header: "LOG",
                                            body: {
                                            rows:[
                                                {
                                                    view: "pager",
                                                    id:"myPager",
                                                    animate: { direction:"top" },
                                                    group: 10,
                                                    size: 15
                                                },
                                                {
                                                     view:"list",
                                                     pager: "myPager",
                                                     template:"#title#",
                                                     id: "script_bet_log_board",
                                                }
                                            ]
                                            }
                                        },
                                    ]
                                },
                                {
                                    id: "script_bet_form_start_stop_buttons",
                                    view: "form",
                                    margin: 0,
                                    padding: 0,
                                    borderless: true,
                                    minHeight: 70,
                                    width: 0,
                                    elements: [
                                        {
                                            id: "script_bet_start_stop_button",
                                            view: "button",
                                            type: "form",
                                            label: "START",
                                            css: "webix_primary",
                                            value: "START"
                                        },
                                        {
                                            id: "script_bet_stop_on_next_win_button",
                                            view: "button",
                                            type: "form",
                                            css: "webix_secondary",
                                            label: "STOP ON NEXT WIN"
                                        },
                                        {
                                            id: "script_bet_stop_on_next_loss_button",
                                            view: "button",
                                            type: "form",
                                            css: "webix_secondary",
                                            label: "STOP ON NEXT LOSS"
                                        },
                                ]}
                            ]
                        }
                    },
                    {
                         header: "BOT",
                         body: {
                             id: "site_form",
                             view: "form",
                             minHeight: 500,
                             width: 0,
                             elements: [
                                {view:"iframe", src:"//mydicebot.com"}
                             ]
                         }
                     },
                ]
            };
            if(webix.env.mobile) {
                bet_config_tabview = {
                    id: "bet_config_tabview",
                    view: "tabview",
                    tabbar:{
                        optionWidth:70
                    },
                    width: 400,
                    cells: [
                        {
                          header: "CHAT",
                          body: {
                            view:"comments",
                            id:"chat",
                            width: 0,
                            height: 0,
                            //minHeight: 300,
                            url:  dataProxy,
                            save: dataProxy
                          }
                        },
                        {
                            header: "MANUAL",
                            body: {
                                id: "manual_bet_form",
                                view: "form",
                                paddingY: 4,
                                margin: 0,
                                minHeight: 500,
                                height: 0,
                                width: 0,
                                elements: [
                                    {
                                        id: "manual_bet_amount",
                                        view: "text",
                                        label: "BET AMOUNT",
                                        value: "0.00000001",
                                        labelWidth: 200,
                                        name: "manual_bet_amount"
                                    },
                                    {
                                        cols: [
                                            {
                                                id: "manual_bet_amount_min_button",
                                                view: "button",
                                                label: "MIN",
                                                css: "webix_secondary",
                                            },
                                            {
                                                id: "manual_bet_amount_max_button",
                                                view: "button",
                                                label: "MAX",
                                                css: "webix_secondary",
                                            },
                                            {
                                                id: "manual_bet_amount_half_button",
                                                view: "button",
                                                label: "1/2",
                                                css: "webix_secondary",
                                            },
                                            {
                                                id: "manual_bet_amount_double_button",
                                                view: "button",
                                                label: "2x",
                                                css: "webix_secondary",
                                            },
                                        ]
                                    },
                                    {
                                        id: "manual_bet_chance",
                                        view: "text",
                                        label: "BET CHANCE",
                                        value: "49.50",
                                        labelWidth: 200,
                                        name: "manual_bet_chance"
                                    },
                                    {
                                        id: "manual_bet_low_button",
                                        view: "button",
                                        type: "form",
                                        label: "BET LOW",
                                        css: "webix_secondary",
                                    },
                                    {
                                        id: "manual_bet_high_button",
                                        view: "button",
                                        type: "form",
                                        label: "BET HIGH",
                                        css: "webix_secondary",
                                    }
                                ]
                            }
                        },
                        {
                            header: "AUTO",
                            body: {
                                view:"fullscreenlayout",
                                height:0,
                                cells:[
                                //rows: [
                                {
                                id: "auto_bet_form",
                                view: "form",
                                paddingY: 4,
                                margin: 0,
                                height: 0,
                                width: 0,
                                scroll:true,
                                relative:true,
                                elements: [
                                    {
                                        id: "auto_bet_number_of_bets",
                                        view: "text",
                                        label: "NUM OF BETS(0:UNLIMITED)",
                                        labelWidth: 240,
                                        value: "0"
                                    },
                                    {
                                        id: "auto_bet_start_low_high",
                                        view: "richselect",
                                        label: "START(LOW/HIGH)",
                                        labelWidth: 240,
                                        value: "LOW",
                                        options: ["LOW", "HIGH"]
                                    },
                                    {
                                        id: "auto_bet_base_amount",
                                        view: "text",
                                        label: "BET BASE AMOUNT",
                                        value: "0.00000001",
                                        labelWidth: 240,
                                        name: "auto_bet_base_amount"
                                    },
                                    {
                                        cols:[
                                            {
                                                id: "auto_bet_amount_radio_on_loss",
                                                label: "ON LOSS",
                                                view: "radio",
                                                value: "RESET TO BASE AMOUNT",
                                                options: [
                                                    {value: "RESET TO BASE AMOUNT"}, 
                                                    {value: "MULTIPLIER", newline:true}
                                                ]
                                            },
                                            {
                                                rows:[
                                                    {view: "label"},
                                                    {
                                                        id: "auto_bet_amount_radio_on_loss_multiplier",
                                                        view: "text",
                                                        width: 60,
                                                        value: "2"
                                                    }

                                                ]
                                            }
                                        ]

                                    },
                                    {
                                        cols:[
                                            {
                                                id: "auto_bet_amount_radio_on_win",
                                                label: "ON WIN",
                                                view: "radio",
                                                value: "RESET TO BASE AMOUNT",
                                                options: [
                                                    {value:"RESET TO BASE AMOUNT"}, 
                                                    {value:"MULTIPLIER", newline:true}
                                                ]
                                            },
                                            {
                                                rows: [
                                                    {view: "label"},
                                                    {
                                                        id: "auto_bet_amount_radio_on_win_multiplier",
                                                        view: "text",
                                                        width: 60,
                                                        value: "2"
                                                    }
                                                ]
                                            }
                                        ]
                                    },
                                    {
                                        id: "auto_bet_base_chance",
                                        view: "text",
                                        label: "BET BASE CHANCE",
                                        value: "49.50",
                                        labelWidth: 240,
                                        name: "auto_bet_base_chance"
                                    },
                                    {
                                        cols:[
                                            {
                                                id: "auto_bet_stop_on_roll",
                                                label: "STOP ON ROLL",
                                                view: "label",
                                                labelWidth: 150,
                                                name: "auto_bet_stop_on_roll"
                                            },
                                            {
                                                id: "auto_bet_roll_min",
                                                label: "MIN",
                                                view: "text",
                                                labelWidth: 40,
                                                width: 100,
                                                value: "0.00",
                                                name: "auto_bet_roll_min"
                                            },
                                            {
                                                id: "auto_bet_roll_max",
                                                label: " -- MAX",
                                                view: "text",
                                                labelWidth: 60,
                                                width: 120,
                                                value: "0.00",
                                                name: "auto_bet_roll_max"
                                            }
                                        ]
                                    },
                                    {
                                        id: "auto_bet_stop_on_profit",
                                        view: "text",
                                        label: "STOP ON PROFIT(0:NON-STOP)",
                                        labelWidth: 230,
                                        value: "0.00000000",
                                        name: "auto_bet_stop_on_profit"
                                    },
                                    {
                                        id: "auto_bet_stop_on_win",
                                        view: "text",
                                        label: "STOP ON WIN(0:NON-STOP)",
                                        labelWidth: 230,
                                        value: "0",
                                        name: "auto_bet_stop_on_win"
                                    },
                                    {
                                        id: "auto_bet_stop_on_loss",
                                        view: "text",
                                        label: "STOP ON LOSS(0:NON-STOP)",
                                        labelWidth: 230,
                                        value: "0",
                                        name: "auto_bet_stop_on_loss"
                                    },
                                ]},
                                {
                                    id: "auto_bet_start_stop_button",
                                    view: "button",
                                    type: "form",
                                    label: "START",
                                    value: "START",
                                    css: "webix_primary",
                                    bottom: 30,
                                    right: 30,
                                    width: 80,
                                    height: 30,
                                },
                                {
                                    id: "auto_bet_stop_on_next_win_button",
                                    view: "button",
                                    type: "form",
                                    css: "webix_secondary",
                                    label: "STOP ON NEXT WIN",
                                    bottom: 10,
                                    right: 30,
                                    width: 80,
                                    height: 30,
                                },
                                {
                                    id: "auto_bet_stop_on_next_loss_button",
                                    view: "button",
                                    type: "form",
                                    label: "STOP ON NEXT LOSS",
                                    css: "webix_secondary",
                                    bottom: 10,
                                    right: 30,
                                    width: 80,
                                    height: 30,
                                },
                            ]}
                        },
                        {
                            header: "SCRIPT",
                            body: {
                                view:"fullscreenlayout",
                                height:0,
                                cells:[
                                {
                                id: "script_bet_form",
                                view: "form",
                                paddingY: 4,
                                margin: 0,
                                height: 0,
                                width: 0,
                                relative:true,
                                elements: [
                                    {
                                        cols: [
                                        {
                                            id: "script_bet_menu",
                                            view:"menu",
                                            width: 80,
                                            data:[
                                                { id:"1",value:"MENU", submenu:[
                                                    "Import",
                                                    "Save", 
                                                    "Save As..",
                                                    "Delete"
                                                ]}
                                            ],
                                            openAction:"click",
                                            on:{
                                                onMenuItemClick:function(id){
                                                    if(this.getMenuItem(id).value == 'Save') {
                                                        saveScript($$("script_code_name").getValue());
                                                    } else if (this.getMenuItem(id).value == 'Import') {
                                                        $$("uploadScript").fileDialog();
                                                    } else if (this.getMenuItem(id).value == 'Save As..') {
                                                        $$('script_code').show();
                                                    } else if (this.getMenuItem(id).value == 'Delete') {
                                                        delScript($$("script_code_name").getValue());
                                                    }
                                                }
                                            },
                                            type:{
                                                subsign:true
                                            }
                                        },
                                        {
                                            options: [
                                            ],
                                            view: "richselect",
                                            value: "Untitled.lua",
                                            placeholder: "Untitled.lua",
                                            id: "script_bet_strategy_list",
                                            name: "script_bet_strategy_list"
                                        },
                                        ]
                                    },
                                    {
                                        view:"radio", id:"script_language_radio",  name:"script_language_radio", label:"Script", value:"lua",  options:["lua", "javascript"]
                                    },
                                    {
                                        id: "script_bet_tabview",
                                        view: "tabview",
                                        relative:true,
                                        height: 0,
                                        cells: [
                                            {
                                                header: "CODE",
                                                body: {
                                                    view:"fullscreenlayout",
                                                    cells:[
                                                        {
                                                            id: "script_bet_coding_board",
                                                            view: "codemirror-editor",
                                                            mode: "lua",
                                                            theme: "#{codeSkin}",
                                                            height:0,
                                                            relative:true
                                                        },
                                                        {
                                                            id:"script_expand_button",
                                                            view: "button",
                                                            css:{"z-index": 10},
                                                            type: "image",
                                                            image:"../images/expand.png",
                                                            bottom: 20,
                                                            right: 35,
                                                            width: 25,
                                                            height: 25,
                                                            click: expand,
                                                         },
                                                         {
                                                            id:"script_save_button",
                                                            view: "button",
                                                            css:{"z-index": 10 },
                                                            type: "image",
                                                            image:"../images/save.png",
                                                            bottom: 60,
                                                            right: 35,
                                                            width: 25,
                                                            height: 25,
                                                            click: "saveScript($$('script_code_name').getValue());",
                                                         },
                                                         {
                                                                id: "script_bet_start_stop_button",
                                                                view: "button",
                                                                type: "form",
                                                                css: "webix_primary",
                                                                label: "START",
                                                                value: "START",
                                                                bottom: 100,
                                                                right: 30,
                                                                width: 80,
                                                                height: 30,
                                                         },
                                                         {
                                                             id: "script_bet_stop_on_next_win_button",
                                                             view: "button",
                                                             type: "form",
                                                             label: "STOP ON NEXT WIN",
                                                                css: "webix_primary",
                                                             bottom: 10,
                                                             right: 30,
                                                             width: 80,
                                                             height: 30,
                                                         },
                                                         {
                                                             id: "script_bet_stop_on_next_loss_button",
                                                             view: "button",
                                                             type: "form",
                                                             label: "STOP ON NEXT LOSS",
                                                                css: "webix_primary",
                                                             bottom: 10,
                                                             right: 30,
                                                             width: 80,
                                                             height: 30,
                                                         },
                                                         ]
                                                }
                                            },
                                            {
                                                header: "LOG",
                                                body: {
                                                rows:[
                                                    {
                                                        view: "pager",
                                                        id:"myPager",
                                                        animate: { direction:"top" },
                                                        group: 10,
                                                        size: 15
                                                    },
                                                    {
                                                         view:"list",
                                                         pager: "myPager",
                                                         template:"#title#",
                                                         id: "script_bet_log_board",
                                                    }
                                                ]
                                                }
                                            },
                                        ]
                                    }
                                    ]
                                } 
                                 ]
                            },
                        },
                        {
                             header: "BOT",
                             body: {
                                 id: "site_form",
                                 view: "form",
                                 minHeight: 500,
                                 width: 0,
                                 elements: [
                                    {view:"iframe", src:"//mydicebot.com"}
                                 ]
                             }
                         },
                    ]
                };
            }
            webix.ui({
                  id:"uploadScript",
                  view:"uploader",
                  upload:"upload",
                  on:{
                    onBeforeFileAdd:function(item){
                      var type = item.type.toLowerCase();
                      if (!(type == "lua" || type == "js" || type == "py")){
                        webix.message("Only Lua,Javascript,Python are supported");
                        return false;
                      }
                    },
                    onFileUpload:function(item){
                        loadScript(item.name);
                    },
                    onFileUploadError:function(item){
                      webix.alert("Error during file upload");
                    }
                  },
                  apiOnly:true
            });
            webix.ui({
                id:"script_code",
                view:"window",
                height:140,
                width:350,
                head:"Save Script",
                position:"center",
                move:true,
                body:{
                   view:"toolbar",
                   rows:[
                       {view:"text", name:"script_code_name", id:"script_code_name", label:"File Name", value:"Untitled.lua"},
                       {
                           cols:[
                                { view:"button", label: 'Cancel', css: "webix_secondary", click:"$$('script_code').hide();"},
                                { view:"button", label: 'Save', css: "webix_secondary",  click:"saveScript($$('script_code_name').getValue());"}
                            ]
                       }
                   ]
                }
            });
            var github_auth_button = {
                id: "github_auth_button",
                view: "button",
                width: 400,
                height: 80,
                type: "imageTop",
                image:"../images/github.png",
            };
            var facebook_auth_button = {
                id: "facebook_auth_button",
                view: "button",
                width: 400,
                height: 80,
                type: "imageTop",
                image:"../images/facebook.png",
            };
            var google_auth_button = {
                id: "google_auth_button",
                view: "button",
                width: 400,
                height: 80,
                type: "imageTop",
                image:"../images/google.png",
            };
            var steem_auth_button = {
                id: "steem_auth_button",
                view: "button",
                width: 400,
                height: 80,
                type: "imageTop",
                image:"../images/steem.png",
            };
            var login_close_button = {
                id: "login_close_button",
                view: "button",
                width: 400,
                height: 80,
                type: "imageTop",
                image:"../images/close.png",
            };
            webix.ui({
                id:"switch_oauth",
                view:"window",
                width:150,
                height:320,
                head:false,
                move:true,
                modal:true,
                position:"center",
                body:{
                   view:"toolbar",
                   rows:[
                        github_auth_button,
                        steem_auth_button,
                        google_auth_button,
                        login_close_button
                       ]
               }
            });
            var misc_items = {
                id: "misc_items_form",
                view: "form",
                paddingX: 10,
                paddingY: 0,
                margin: 0,
                height: 210,
                elements: [
                    bet_currency_selection,
                    bet_house_edge_selection,
                    reset_session_button,
                    switch_site_button,
                    dice_site_ref_info,
                ]
            };
            var user_info = {
                id: "user_info_form",
                view: "form",
                padding: 0,
                margin: 0,
                height: 210,
                width: 190,
                elements: [
                    user_login_logout_button,
                    user_info_stats
                ]
            };
            var mobile_toolbar = {
                id:"mobile_toolbar",
                view:"toolbar",
                width: 100,
                padding: 0,
                margin: -5,
                rows:[
                    { id: "mobile_toolbar_userinfo", view:"button", value:"USER", css: "webix_secondary" },
                    { id: "mobile_toolbar_total", view:"button", value:"TOTAL", css: "webix_secondary" },
                    { id: "mobile_toolbar_stats1", view:"button", value:"STATS 1", css: "webix_secondary" },
                    { id: "mobile_toolbar_stats2", view:"button", value:"STATS 2", css: "webix_secondary" },
                    { id: "mobile_toolbar_chart", view:"button", value:"CHART", css: "webix_secondary" },
                    { id: "mobile_toolbar_history", view:"button", value:"HISTORY", css: "webix_secondary" },
                    { id: "mobile_toolbar_setting", view:"button", value:"SETTING", css: "webix_secondary" }
                ]
            };
            if(!webix.env.mobile) {
                webix.ui(
                {
                    id: "bet_layout",
                    rows: [
                        {
                            cols: [
                                bet_total_stats,
                                {view:"resizer"},
                                bet_current_stats,
                                {view:"resizer"},
                                bet_current_stats2,
                                {view:"resizer"},
                                misc_items,
                                {view:"resizer"},
                                user_info,
                            ]
                        },
                        {view:"resizer"},
                        {
                            cols: [
                                {rows: [bet_chart, {view:"resizer"}, bet_datatable]},
                                {view:"resizer"},
                                bet_config_tabview
                            ]
                        },
                    ]
                });
            } else {
                webix.ui.fullScreen();
                webix.ui(
                {
                    id: "bet_layout_mobile",
                    rows: [
                        {
                            cols: [
                                mobile_toolbar,
                                bet_total_stats,
                                bet_current_stats,
                                bet_current_stats2,
                                bet_chart,
                                bet_datatable,
                                misc_items, 
                                user_info,
                            ]
                        },       
                        bet_config_tabview
                    ]
                });
                webix.Touch.limit(true);
                $$("bet_total_stats").hide();

                $$("bet_current_stats").hide();

                $$("bet_current_stats2").hide();

                $$("misc_items_form").hide();
                $$("user_info_form").show();
                $$("user_info_form").define("height", 0);
                $$("user_info_form").define("width", 0);

                $$("bet_chart").hide();

                $$("bet_datatable").hide();

                $$("bet_config_tabview").define("height", 380);
                $$("bet_config_tabview").define("width", 0);

                $$("auto_bet_stop_on_next_win_button").hide();
                $$("auto_bet_stop_on_next_loss_button").hide();

                $$("script_bet_stop_on_next_win_button").hide();
                $$("script_bet_stop_on_next_loss_button").hide();

                $$("manual_bet_amount").attachEvent("onFocus", function(current_view, prev_view){
                    let layout = $$("mobile_toolbar").getParentView();
                    layout.hide();
                });
                $$("manual_bet_amount").attachEvent("onBlur", function(current_view, prev_view){
                    let layout = $$("mobile_toolbar").getParentView();
                    layout.show();
                });
                $$("manual_bet_chance").attachEvent("onFocus", function(current_view, prev_view){
                    let layout = $$("mobile_toolbar").getParentView();
                    layout.hide();
                });
                $$("manual_bet_chance").attachEvent("onBlur", function(current_view, prev_view){
                    let layout = $$("mobile_toolbar").getParentView();
                    layout.show();
                });
                $$("auto_bet_number_of_bets").attachEvent("onFocus", function(current_view, prev_view){
                    let layout = $$("mobile_toolbar").getParentView();
                    layout.hide();
                });
                $$("auto_bet_number_of_bets").attachEvent("onBlur", function(current_view, prev_view){
                    let layout = $$("mobile_toolbar").getParentView();
                    layout.show();
                });
                $$("auto_bet_base_amount").attachEvent("onFocus", function(current_view, prev_view){
                    let layout = $$("mobile_toolbar").getParentView();
                    layout.hide();
                });
                $$("auto_bet_base_amount").attachEvent("onBlur", function(current_view, prev_view){
                    let layout = $$("mobile_toolbar").getParentView();
                    layout.show();
                });
                $$("auto_bet_amount_radio_on_loss_multiplier").attachEvent("onFocus", function(current_view, prev_view){
                    let layout = $$("mobile_toolbar").getParentView();
                    layout.hide();
                });
                $$("auto_bet_amount_radio_on_loss_multiplier").attachEvent("onBlur", function(current_view, prev_view){
                    let layout = $$("mobile_toolbar").getParentView();
                    layout.show();
                });
                $$("auto_bet_amount_radio_on_win_multiplier").attachEvent("onFocus", function(current_view, prev_view){
                    let layout = $$("mobile_toolbar").getParentView();
                    layout.hide();
                });
                $$("auto_bet_amount_radio_on_win_multiplier").attachEvent("onBlur", function(current_view, prev_view){
                    let layout = $$("mobile_toolbar").getParentView();
                    layout.show();
                });
                $$("auto_bet_base_chance").attachEvent("onFocus", function(current_view, prev_view){
                    let layout = $$("mobile_toolbar").getParentView();
                    layout.hide();
                });
                $$("auto_bet_base_chance").attachEvent("onBlur", function(current_view, prev_view){
                    let layout = $$("mobile_toolbar").getParentView();
                    layout.show();
                });
                $$("auto_bet_roll_min").attachEvent("onFocus", function(current_view, prev_view){
                    let layout = $$("mobile_toolbar").getParentView();
                    layout.hide();
                });
                $$("auto_bet_roll_min").attachEvent("onBlur", function(current_view, prev_view){
                    let layout = $$("mobile_toolbar").getParentView();
                    layout.show();
                });
                $$("auto_bet_roll_max").attachEvent("onFocus", function(current_view, prev_view){
                    let layout = $$("mobile_toolbar").getParentView();
                    layout.hide();
                });
                $$("auto_bet_roll_max").attachEvent("onBlur", function(current_view, prev_view){
                    let layout = $$("mobile_toolbar").getParentView();
                    layout.show();
                });
                $$("auto_bet_stop_on_profit").attachEvent("onFocus", function(current_view, prev_view){
                    let layout = $$("mobile_toolbar").getParentView();
                    layout.hide();
                });
                $$("auto_bet_stop_on_profit").attachEvent("onBlur", function(current_view, prev_view){
                    let layout = $$("mobile_toolbar").getParentView();
                    layout.show();
                });
                $$("auto_bet_stop_on_win").attachEvent("onFocus", function(current_view, prev_view){
                    let layout = $$("mobile_toolbar").getParentView();
                    layout.hide();
                });
                $$("auto_bet_stop_on_win").attachEvent("onBlur", function(current_view, prev_view){
                    let layout = $$("mobile_toolbar").getParentView();
                    layout.show();
                });
                $$("auto_bet_stop_on_loss").attachEvent("onFocus", function(current_view, prev_view){
                    let layout = $$("mobile_toolbar").getParentView();
                    layout.hide();
                });
                $$("auto_bet_stop_on_loss").attachEvent("onBlur", function(current_view, prev_view){
                    let layout = $$("mobile_toolbar").getParentView();
                    layout.show();
                });

                $$("mobile_toolbar_userinfo").attachEvent("onItemClick", function(){
                    $$("user_info_form").show();
                    $$("bet_total_stats").hide();
                    $$("bet_current_stats").hide();
                    $$("bet_current_stats2").hide();
                    $$("bet_chart").hide();
                    $$("bet_datatable").hide();
                    $$("misc_items_form").hide();
                });
                $$("mobile_toolbar_total").attachEvent("onItemClick", function(){
                    $$("bet_total_stats").show();
                    $$("bet_current_stats").hide();
                    $$("bet_current_stats2").hide();
                    $$("bet_chart").hide();
                    $$("bet_datatable").hide();
                    $$("misc_items_form").hide();
                    $$("user_info_form").hide();
                });
                $$("mobile_toolbar_stats1").attachEvent("onItemClick", function(){
                    $$("bet_total_stats").hide();
                    $$("bet_current_stats").show();
                    $$("bet_current_stats2").hide();
                    $$("bet_chart").hide();
                    $$("bet_datatable").hide();
                    $$("misc_items_form").hide();
                    $$("user_info_form").hide();
                });
                $$("mobile_toolbar_stats2").attachEvent("onItemClick", function(){
                    $$("bet_total_stats").hide();
                    $$("bet_current_stats").hide();
                    $$("bet_current_stats2").show();
                    $$("bet_chart").hide();
                    $$("bet_datatable").hide();
                    $$("misc_items_form").hide();
                    $$("user_info_form").hide();
                });
                $$("mobile_toolbar_chart").attachEvent("onItemClick", function(){
                    $$("bet_total_stats").hide();
                    $$("bet_current_stats").hide();
                    $$("bet_current_stats2").hide();
                    $$("bet_chart").show();
                    $$("bet_datatable").hide();
                    $$("misc_items_form").hide();
                    $$("user_info_form").hide();
                });
                $$("mobile_toolbar_history").attachEvent("onItemClick", function(){
                    $$("bet_total_stats").hide();
                    $$("bet_current_stats").hide();
                    $$("bet_current_stats2").hide();
                    $$("bet_chart").hide();
                    $$("bet_datatable").show();
                    $$("bet_datatable").hideColumn("bet_datatable_id");
                    $$("bet_datatable").hideColumn("bet_datatable_payout");
                    $$("misc_items_form").hide();
                    $$("user_info_form").hide();
                });
                $$("mobile_toolbar_setting").attachEvent("onItemClick", function(){
                    $$("bet_total_stats").hide();
                    $$("bet_current_stats").hide();
                    $$("bet_current_stats2").hide();
                    $$("bet_chart").hide();
                    $$("bet_datatable").hide();
                    $$("misc_items_form").show();
                    $$("user_info_form").hide();
                });
            }
            webix.extend($$("bet_chart"), webix.ProgressBar);
            if(webix.env.mobile) {
                mobiles.forEach(function(element) {
                    webix.extend($$(element), webix.ProgressBar);
                });
            }
            $$("script_bet_start_stop_button").attachEvent("onItemClick", function(){
                buttonStatus = $$("script_bet_start_stop_button").getValue();
                if(buttonStatus == 'STOP') {
                    isloop = false;
                    $$("script_bet_start_stop_button").setValue('START');
                } else {
                    currencyValue = $$("bet_currency_selection").getValue() -1;
                    bethigh = false;
                    if(currentLanguage == 'lua') fengari.load('bethigh= false')();
                    initScriptBalance(currencyValue, function(){
                        code = $$("script_bet_coding_board").getValue().toLowerCase();
                        humps.forEach(function(element) {
                            code = code.replace(new RegExp(element, "gm"), element.toLowerCase());
                        });
                        try {
                            if(currentLanguage == 'lua') {
                                code = code.replace(/!=/g,"~=");
                                code = code.replace(/!/g,"not ");
                                code = code.replace(/base/g,'basebet');
                                code = code.replace(/basebetbet/g,'basebet');
                                code = code.replace(/([a-zA-Z]*[0-9]*\s*)\+\=(\s*[a-zA-Z]*[0-9]*)/g, '$1=$1+$2 ');
                                code = code.replace(/([a-zA-Z]*[0-9]*\s*)\-\=(\s*[a-zA-Z]*[0-9]*)/g, '$1=$1-$2 ');
                                code = code.replace(/([a-zA-Z]*[0-9]*\s*)\*\=(\s*[a-zA-Z]*[0-9]*)/g, '$1=$1*$2 ');
                                code = code.replace(/([a-zA-Z]*[0-9]*\s*)\/\=(\s*[a-zA-Z]*[0-9]*)/g, '$1=$1/$2 ');
                                fengari.load('balance='+balance+'\nbets='+bets+'\nwins='+wins+'\nlosses='+ losses +'\nprofit='+profit+'\n')();
                                fengari.load(code)();
                            }
                            if (currentLanguage == 'javascript') evalScript(code);
                        } catch(err){
                            console.error(err.message);
                            webix.message({type: 'error', text: "load error:"+err.message});
                            return false;
                        }
                        isloop = true;
                        $$("script_bet_start_stop_button").setValue('STOP');
                        scriptBet(true);
                    });
                }
            });
            $$("auto_bet_start_stop_button").attachEvent("onItemClick", function(){
                buttonStatus = $$("auto_bet_start_stop_button").getValue();
                if(buttonStatus == 'STOP') {
                    isloop = false;
                    $$("auto_bet_start_stop_button").setValue('START');
                } else {
                    $$("auto_bet_start_stop_button").setValue('STOP');
                    autoBet();
                    isloop = true;
                    stopOnWin = false;
                    stopOnLoss = false;
                }
            });
            $$("manual_bet_amount_min_button").attachEvent("onItemClick", function(){
                $$("manual_bet_amount").setValue(minBetAmount);
            });
            $$("manual_bet_amount_max_button").attachEvent("onItemClick", function(){
                getInfo(function(userinfo){
                    balance = getBalance(userinfo);
                    $$("manual_bet_amount").setValue(balance);
                });
            });
            $$("manual_bet_amount_half_button").attachEvent("onItemClick", function(){
                betAmount = $$("manual_bet_amount").getValue()/2;
                $$("manual_bet_amount").setValue(Math.max(minBetAmount, betAmount).toFixed(8));
            });
            $$("manual_bet_amount_double_button").attachEvent("onItemClick", function(){
                getInfo(function(userinfo){
                    balance = getBalance(userinfo);
                    currencyValue = $$("bet_currency_selection").getValue() -1;
                    betAmount = $$("manual_bet_amount").getValue()*2;
                    $$("manual_bet_amount").setValue(Math.min(balance, betAmount).toFixed(8));
                });
            });
            $$("auto_bet_stop_on_next_win_button").attachEvent("onItemClick", function(){
                stopOnWin = true;
            });
            $$("auto_bet_stop_on_next_loss_button").attachEvent("onItemClick", function(){
                stopOnLoss = true;
            });
            $$("script_bet_stop_on_next_win_button").attachEvent("onItemClick", function(){
                stopOnWin = true;
            });
            $$("script_bet_stop_on_next_loss_button").attachEvent("onItemClick", function(){
                stopOnLoss = true;
            });
            $$("switch_site_button").attachEvent("onItemClick", function(id, e){
                webix.confirm({
                    title:"CONFIRMATION",
                    ok:"Yes",
                    cancel:"No",
                    text:"Logout/Switch Site will reset current session. Sure?",
                    callback:function(result){
                        if(result) {
                            let domain = document.domain;
                            window.location.href = '../login';
                        }
                    }
                });
            });
            $$("manual_bet_low_button").attachEvent("onItemClick", function(){
                isloop = false;
                currency = $$("bet_currency_selection").getText().toLowerCase();
                var payIn = $$("manual_bet_amount").getValue();
                chance = $$("manual_bet_chance").getValue();
                bet(currency, false, parseInt(payIn*100000000), chance);
            });
            $$("manual_bet_high_button").attachEvent("onItemClick", function(){
                isloop = false;
                currency = $$("bet_currency_selection").getText().toLowerCase();
                var payIn = $$("manual_bet_amount").getValue();
                chance = $$("manual_bet_chance").getValue();
                bet(currency, true, parseInt(payIn*100000000), chance);
            });
            $$("bet_currency_selection").attachEvent("onChange", function(newId, oldId){
                refresh(newId);
            });
            $$("reset_session_button").attachEvent("onItemClick", function(){
                webix.confirm({
                    title:"CONFIRMATION",
                    ok:"Yes",
                    cancel:"No",
                    text:"Reset current session. Sure?",
                    callback:function(result){
                        if(result){
                            currencyValue = $$("bet_currency_selection").getValue();
                            refresh(currencyValue);
                        }
                    }
                });
            });

            $$("script_bet_strategy_list").attachEvent("onChange", function(newId, oldId){
                if(newId && typeof newId !== 'object'){
                    if(currentCodeChanged()){
                        webix.confirm({
                            title:"CONFIRMATION",
                            ok:"Save",
                            cancel:"No",
                            text:"Your code has not been saved yet. Do you need to save it?",
                            callback:function(result){
                                if(result) {
                                    saveScriptSync($$("script_code_name").getValue(),$$("script_language_radio").getValue());
                                }
                                $$("script_code_name").setValue(newId);
                                loadScriptContent(newId);
                            }
                        });
                    } else {
                        $$("script_code_name").setValue(newId);
                        loadScriptContent(newId);
                    }
                }
            });
            $$("script_language_radio").attachEvent("onChange", function(newId, oldId){
                if(currentCodeChanged()){
                    webix.confirm({
                        title:"CONFIRMATION",
                        ok:"Save",
                        cancel:"No",
                        text:"Your code has not been saved yet. Do you need to save it?",
                        callback:function(result){
                            if(result) {
                                let cm = $$("script_bet_coding_board")._editor;
                                saveScriptSync($$("script_code_name").getValue(),oldId);
                                cm.execCommand("changeGutterMarker");
                            }
                            changeMode(newId);
                        }
                    });
                } else {
                    changeMode(newId);
                }
            });
            webix.ready(function(){
                init();
                refresh(1);
                loadScript();
                checkUser();
                webix.html.addStyle(".webix_primary{ z-index:10; }");
            });
            function checkUser(my_window) {
              if(typeof my_window !=='undefined' && true == my_window.closed)
              {
                  clearTimeout(intervalID);
              }
              webix.ajax().get('user').then(function (result) {
                  let user = result.json();
                  if(user.sid) {
                    dataProxy.client.emit('login',user.sid);
                    $$("chat").setCurrentUser(user.user.uid, user.user.username, user.user.avatarUrl);
                    if(!user.user.avatarUrl) {
                        user.user.avatarUrl = "../images/guest_logged_in.png";
                    }
                    $$("user_login_logout_button").config.image = user.user.avatarUrl;
                    $$("user_login_logout_button").config.label = 'click to logout';
                    $$("user_login_logout_button").refresh();
                    $$('user_info_stats').setValues({
                        user_id:user.user.uid,
                        user_name:user.user.username
                    });
                    clearTimeout(intervalID);
                    if(typeof my_window !=='undefined' && true == my_window.closed)
                    {
                        my_window.close();
                    }
                  }
              }).fail(function (xhr) {
                  var response = JSON.parse(xhr.response);
                  $$("user_login_logout_button").config.image = "../images/guest.png";
                  $$("user_login_logout_button").config.label = 'click to login';
                  $$("user_login_logout_button").refresh();
                  console.error(response.err);
                  //webix.message({type: 'error', text: response.err});
              });
            }
            $$("user_login_logout_button").attachEvent("onItemClick", function(){
                if ($$("user_login_logout_button").config.label == "click to login"){
                    $$('switch_oauth').show();
                } else {
                    webix.confirm({
                        title:"CONFIRMATION",
                        ok:"Yes",
                        cancel:"No",
                        text:"Do you want to logout?",
                        callback:function(result){
                            if(result){
                                webix.ajax().get('logout').then(function (ret) {
                                    $$("user_login_logout_button").config.image = "../images/guest.png";
                                    $$("user_login_logout_button").config.label = 'click to login';
                                    $$('user_info_stats').setValues({
                                        user_id:'',
                                        user_name:''
                                    });
                                    $$("user_login_logout_button").refresh();
                                }).fail(function (xhr) {
                                    var response = JSON.parse(xhr.response);
                                    console.error(response.err);
                                    webix.message({type: 'error', text: response.err});
                                });
                            }
                        }
                    });
                }
            });
            $$("github_auth_button").attachEvent("onItemClick", function(){
                $$('switch_oauth').hide();
                github_login_page = window.open(
                        "#{authGithub}",
                        "login",
                        "width=600,height=600,status=0,toolbar=0"
                        );
                intervalID = setInterval(function(){checkUser(github_login_page);}, 3000);
            });
            $$("google_auth_button").attachEvent("onItemClick", function(){
                $$('switch_oauth').hide();
                google_login_page = window.open(
                        decodeURIComponent("#{authGoogle}"),
                        "login",
                        "width=600,height=600,status=0,toolbar=0"
                        );
                intervalID = setInterval(function(){checkUser(google_login_page);}, 3000);
            });
            $$("steem_auth_button").attachEvent("onItemClick", function(){
                $$('switch_oauth').hide();
                steem_login_page = window.open(
                        decodeURIComponent("#{authSteem}"),
                        "login",
                        "width=600,height=600,status=0,toolbar=0"
                        );
                intervalID = setInterval(function(){checkUser(steem_login_page);}, 3000);
            });
            $$("login_close_button").attachEvent("onItemClick", function(){
                $$('switch_oauth').hide();
            });
            function loadScriptContent(filename) {
                webix.ajax().get('file?file='+filename).then(function (result) {
                    let ret = result.json();
                    $$("script_bet_coding_board").setValue(ret);
                }).fail(function (xhr) {
                    var response = JSON.parse(xhr.response);
                    console.error(response.err);
                    webix.message({type: 'error', text: response.err});
                });
            }
            function loadScript(filename){
                let sc = $$("script_language_radio").getValue();
                let ext = 'lua';
                if (sc == "javascript") {
                    ext = 'js';
                } else if (sc == "python") {
                    ext = 'py';
                }
                $$("script_bet_strategy_list").disable();
                $$("bet_chart").showProgress({
                    type:"icon",
                    delay:3000
                });
                if(webix.env.mobile) {
                    mobiles.forEach(function(element) {
                        $$(element).showProgress({
                            type:"icon",
                            delay:3000
                        });
                    });
                }
                webix.ajax().get('script?ext='+ext).then(function (result) {
                    let ret = result.json();
                    $$("script_bet_strategy_list").define("options", ret);
                    if(typeof filename !== "undefined"){
                        $$("script_bet_strategy_list").setValue(filename);
                        loadScriptContent(filename);
                    } else {
                        if(typeof ret[0] !== "undefined") {
                            $$("script_bet_strategy_list").setValue(ret[0].id);
                            $$("script_code_name").setValue(ret[0].id);
                            loadScriptContent(ret[0].id);
                        } else {
                            $$("script_bet_coding_board").setValue('');
                            $$("script_code_name").setValue("Untitled."+ext);
                            $$("script_bet_strategy_list").setValue("Untitled."+ext);
                            $$("script_bet_strategy_list").define("placeholder", "Untitled."+ext);
                            $$("script_bet_strategy_list").refresh();
                        }
                    }
                    $$("script_bet_strategy_list").enable();
                    $$("script_bet_strategy_list").refresh();
                    $$("bet_chart").hideProgress();
                    if(webix.env.mobile) {
                        mobiles.forEach(function(element) {
                            $$(element).hideProgress();
                        });
                    }
                }).fail(function (xhr) {
                    var response = JSON.parse(xhr.response);
                    console.error(response.err);
                    webix.message({type: 'error', text: response.err});
                });
            }
            function saveScriptSync(filename, sc){
                if(filename == '' || filename == 'Untitled.lua'  ){
                    filename = 'Untitled.lua';
                    if (sc == "javascript") {
                        filename = 'Untitled.js';
                    } else if (sc == "python") {
                        filename = 'Untitled.py';
                    }
                }
                $$('script_code').hide();
                let str = $$("script_bet_coding_board").getValue();
                if(str.trim()===""){
                    webix.message({type: 'error', text: 'script is empty! '});
                } else {
                    webix.ajax().sync().post('save', { scriptStr:str, fileName: filename });
                    webix.message({type: 'ok', text: 'save script success'});
                }
            }
            function saveScript(filename){
                let sc = $$("script_language_radio").getValue()
                if(filename == '' || filename == 'Untitled.lua'  ){
                    filename = 'Untitled.lua';
                    if (sc == "javascript") {
                        filename = 'Untitled.js';
                    } else if (sc == "python") {
                        filename = 'Untitled.py';
                    }
                }
                $$('script_code').hide();
                let str = $$("script_bet_coding_board").getValue();
                if(str.trim()===""){
                    webix.message({type: 'error', text: 'script is empty! '});
                } else {
                    webix.ajax().post('save', { scriptStr:str, fileName: filename }).then(function (result) {
                        let ret = result.json();
                        if(ret == 'ok') {
                            let cm = $$("script_bet_coding_board")._editor;
                            if(cm.getOption("fullScreen") != true) {
                                loadScript(filename);
                            } else {
                                cm.execCommand("changeGutterMarker");
                            }
                            webix.message({type: 'ok', text: 'save script success'});
                        }
                    }).fail(function (xhr) {
                        var response = JSON.parse(xhr.response);
                        console.error(response.err);
                        webix.message({type: 'error', text: response.err});
                    });
                }
            }
            function delScript(filename){
                webix.ajax().get('del?file='+filename).then(function (result) {
                    let ret = result.json();
                    if (ret == 'ok') {
                        loadScript();
                    }
                }).fail(function (xhr) {
                    var response = JSON.parse(xhr.response);
                    console.error(response.err);
                    webix.message({type: 'error', text: response.err});
                });
            }
            function autoBet(iswin, previousbet){
                nums =  $$("auto_bet_number_of_bets").getValue();
                currency = $$("bet_currency_selection").getText().toLowerCase();
                base = $$("auto_bet_base_amount").getValue();
                chance = $$("auto_bet_base_chance").getValue();
                bethigh = $$("auto_bet_start_low_high").getValue() == 'LOW' ?false:true;
                autoLossRadio = $$("auto_bet_amount_radio_on_loss").getValue();
                autoWinRadio = $$("auto_bet_amount_radio_on_win").getValue();
                if(iswin == true && autoWinRadio == 'MULTIPLIER'){
                    let multiWin = $$("auto_bet_amount_radio_on_win_multiplier").getValue();
                    base = previousbet * multiWin;
                } else if(iswin == false && autoLossRadio == 'MULTIPLIER') {
                    let multiLoss = $$("auto_bet_amount_radio_on_loss_multiplier").getValue();
                    base = previousbet * multiLoss;
                }
                bet(currency, bethigh, Math.round(parseFloat(base*100000000)), chance);
            }
            function scriptBet(init){
                try{
                    if (currentLanguage == 'lua') {
                        nextbet = fengari.load('return nextbet')();
                        previousbet = fengari.load('return previousbet')();
                        chance = fengari.load('return chance')();
                        bethigh = fengari.load('return bethigh')();
                    }
                    currency = $$("bet_currency_selection").getText().toLowerCase();
                    if(init){
                        nextbet = basebet;
                        if (currentLanguage == 'lua') {
                            fengari.load('nextbet=basebet')();
                            nextbet = fengari.load('return basebet')();
                            fengari.load('previousbet=basebet\ncurrentprofit=0\ncurrentstreak=0\nwins=0\nlosses=0\nbets=0\nisloop=true\nprofit=0\ncurrentroll=0\n')();
                            fengari.load('function stop()\nisloop = false \n print(isloop)\nend')();
                        }
                    } else {
                        if (currentLanguage == 'lua') {
                            fengari.load('dobet()')();
                            nextbet = fengari.load('return nextbet')();
                            chance = fengari.load('return chance')();
                            bethigh = fengari.load('return bethigh')();
                        } else if (currentLanguage == 'javascript') {
                            dobet();
                        }
                    }
                    previousbet = nextbet;
                    if (currentLanguage == 'lua') {
                        fengari.load('previousbet=nextbet')();
                        fengari.load('print("script",basebet,nextbet,previousbet,chance,win,currentprofit,currentstreak,wins,losses,bets,bethigh,isloop,profit,currentroll)')();
                    }
                    betScript(currency, bethigh, Math.round(parseFloat(nextbet*100000000)), chance);
                }catch(err){
                    console.error(err);
                    $$("script_bet_start_stop_button").setValue('START');
                    webix.message({type: 'error', text:"script error:"+ err});
                }
            }
            function action(c,h,p,ch,cv,cb){
                let houseEdgeValue = $$("bet_house_edge_selection").getValue();
                webix.ajax().post('bet', { Currency:c, PayIn:p, High:h, Chance:ch, CurrencyValue: cv, HouseEdge: houseEdgeValue  }).then(function (result) {
                    let ret = result.json();
                    cb(ret);
                }).fail(function (xhr) {
                    var response = JSON.parse(xhr.response);
                    $$("auto_bet_start_stop_button").setValue('START');
                    console.error(response.err);
                    webix.message({type: 'error', text: response.err});
                });
            }
            function checkerr(mess){
                let result = webix.ajax().sync().get('checkerr?mess='+mess+'&count='+errCount ); 
                let ret = JSON.parse(result.responseText);
                errCount = ret.count;
                if(mess != '' && typeof mess !== 'undefined') {
                    console.error(mess);
                    webix.message({type: 'error', text: mess });
                }
                return ret.ret;
            }
            function bet(c,h,p,ch) {
                if(!checkParams(p,ch)) {
                    $$("auto_bet_start_stop_button").setValue('START');
                    console.error('Please enter the correct parameters');
                    webix.message({type: 'error', text: 'Please enter the correct parameters'});
                    return false;
                }
                iswin = false;
                $$("bet_chart").showProgress({
                    type:"icon",
                    delay:3000
                });
                if(webix.env.mobile) {
                    mobiles.forEach(function(element) {
                        $$(element).showProgress({
                            type:"icon",
                            delay:3000
                        });
                    });
                }
                currencyValue = $$("bet_currency_selection").getValue() -1;
                let currentAmount =  p/100000000;
                action(c,h,p,ch,currencyValue,function(ret) {
                    try{
                    if(isError(ret)) {
                            iswin = getWinStatus(ret);
                            setStreak(iswin, currentAmount);
                            setChart(ret, count, currencyValue);
                            setDatatable(ret, iswin);
                            setStats(ret.info, currencyValue);
                            count++
                    } else {
                        isloop = outError(ret);
                    }
                    $$("bet_chart").hideProgress();
                    if(webix.env.mobile) {
                        mobiles.forEach(function(element) {
                            $$(element).hideProgress();
                        });
                    }
                    if (stopOnWin == true && iswin) {
                        isloop = false;
                    }
                    if (stopOnLoss == true && !iswin) {
                        isloop = false;
                    }
                    if (isloop) {
                        currentroll = getCurrentRoll(ret);
                        let rollMin = $$("auto_bet_roll_min").getValue();
                        let rollMax = $$("auto_bet_roll_max").getValue();
                        if(currentroll <= rollMax && currentroll >= rollMin){
                            isloop = false;
                        }
                        let actProfit = getProfit(ret.info, currencyValue)*100000000;
                        let stopProfit = $$("auto_bet_stop_on_profit").getValue()*100000000;
                        if(stopProfit != 0) {
                            if(actProfit>=stopProfit && stopProfit>0){
                                    isloop = false;
                            }
                            if(actProfit<=stopProfit && stopProfit<0){
                                    isloop = false;
                            }
                        }
                        nums =  $$("auto_bet_number_of_bets").getValue();
                        if(nums>0){
                            $$("auto_bet_number_of_bets").setValue(nums-1);
                            if(nums == 1) {
                                isloop = false;
                            }
                        }
                        let lossNums =  $$("auto_bet_stop_on_loss").getValue();
                        if(lossNums>0 && !iswin){
                            $$("auto_bet_stop_on_loss").setValue(lossNums-1);
                            if(lossNums == 1) {
                                isloop = false;
                            }
                        }
                        let winNums =  $$("auto_bet_stop_on_win").getValue();
                        if(winNums>0 && iswin){
                            $$("auto_bet_stop_on_win").setValue(winNums-1);
                            if(winNums == 1) {
                                isloop = false;
                            }
                        }
                        if(isloop){
                            autoBet(iswin,(p/100000000).toFixed(8));
                        } else {
                            $$("auto_bet_start_stop_button").setValue('START');
                        }
                    } else {
                        $$("auto_bet_start_stop_button").setValue('START');
                    }
                    } catch(err){
                        $$("auto_bet_start_stop_button").setValue('START');
                        console.error(err.message);
                        webix.message({type: 'error', text: err.message});
                    }
                });
            }
            function betScript(c,h,p,ch) {
                if(!checkParams(p,ch)) {
                    $$("script_bet_start_stop_button").setValue('START');
                    console.error('Please enter the correct parameters');
                    webix.message({type: 'error', text: 'Please enter the correct parameters'});
                    return false;
                }
                iswin = false;
                if(isloop){
                    if (currentLanguage == 'lua') isloop = fengari.load('return isloop')();
                }
                if(!isloop){
                    $$("script_bet_start_stop_button").setValue('START');
                    return false;
                }
                $$("bet_chart").showProgress({
                    type:"icon",
                    delay:3000
                });
                if(webix.env.mobile) {
                    mobiles.forEach(function(element) {
                        $$(element).showProgress({
                            type:"icon",
                            delay:3000
                        });
                    });
                }
                currencyValue = $$("bet_currency_selection").getValue() -1;
                let currentAmount =  p/100000000;
                action(c,h,p,ch,currencyValue,function(ret) {
                    if(isError(ret)) {
                        try {
                            iswin = getWinStatus(ret);
                            setStreak(iswin, currentAmount);
                            setBetToLua(ret, currencyValue);
                            setChart(ret, count, currencyValue);
                            setDatatable(ret, iswin);
                            setStats(ret.info, currencyValue);
                        } catch(err){
                            console.error(err.message);
                            webix.message({type: 'error', text: err.message});
                        }
                        count++;
                    } else {
                        isloop = outError(ret);
                    }
                    $$("bet_chart").hideProgress();
                    if(webix.env.mobile) {
                        mobiles.forEach(function(element) {
                            $$(element).hideProgress();
                        });
                    }
                    if (stopOnWin == true && iswin) {
                        isloop = false;
                    }
                    if (stopOnLoss == true && !iswin) {
                        isloop = false;
                    }
                    if (isloop) {
                        scriptBet(false);
                    } else {
                        $$("script_bet_start_stop_button").setValue('START');
                    }
                });
            }
            function clearSession(){
                $$('bet_current_stats2').setValues({
                    bet_current_stats_current_streak:0,
                    bet_current_stats_max_win_streak:0,
                    bet_current_stats_max_loss_streak:0,
                    bet_current_stats_max_win_streak_amount:0,
                    bet_current_stats_max_loss_streak_amount:0,
                    bet_current_stats_max_bet_amount:0,
                });
                $$('bet_datatable').clearAll();
                $$("bet_chart").clearAll();
                $$("script_bet_log_board").clearAll();
                maxstreakamount = 0;
                minstreakamount = 0;
                stopOnWin = false;
                stopOnLoss = false;
            }
            function refresh(newId) {
                clear(function(userinfo){
                    setStats(userinfo, newId-1);
                    $$('bet_datatable').clearAll();
                    $$("bet_chart").clearAll();
                    clearSession();
                });
            }
            function clear(cb){
                $$("bet_chart").showProgress({
                    type:"icon",
                    delay:3000
                });
                if(webix.env.mobile) {
                    mobiles.forEach(function(element) {
                        $$(element).showProgress({
                            type:"icon",
                            delay:3000
                        });
                    });
                }
                webix.ajax().get('clear?currency='+$$("bet_currency_selection").getText().toLowerCase()).then(function (result) {
                    let ret = result.json();
                    $$("bet_chart").hideProgress();
                    if(webix.env.mobile) {
                        mobiles.forEach(function(element) {
                            $$(element).hideProgress();
                        });
                    }
                    cb(ret);
                });
            }
            function getInfo(cb){
                $$("bet_chart").showProgress({
                    type:"icon",
                    delay:3000
                });
                if(webix.env.mobile) {
                    mobiles.forEach(function(element) {
                        $$(element).showProgress({
                            type:"icon",
                            delay:3000
                        });
                    });
                }
                webix.ajax().get('refresh?currency='+$$("bet_currency_selection").getText().toLowerCase()).then(function (result) {
                    let ret = result.json();
                    $$("bet_chart").hideProgress();
                    if(webix.env.mobile) {
                        mobiles.forEach(function(element) {
                            $$(element).hideProgress();
                        });
                    }
                    cb(ret);
                });
            }
            function setStreak(win, currentAmount){
                currentstreak = $$('bet_current_stats2').getValues().bet_current_stats_current_streak;
                maxwinstreak = $$('bet_current_stats2').getValues().bet_current_stats_max_win_streak;
                maxlossstreak = $$('bet_current_stats2').getValues().bet_current_stats_max_loss_streak;
                maxwinstreakamount = $$('bet_current_stats2').getValues().bet_current_stats_max_win_streak_amount;
                maxlossstreakamount = $$('bet_current_stats2').getValues().bet_current_stats_max_loss_streak_amount;
                let maxbetamount = $$('bet_current_stats2').getValues().bet_current_stats_max_bet_amount;
                if(currentAmount>maxbetamount){
                    maxbetamount = currentAmount.toFixed(8);
                }
                if(win){
                    maxstreakamount = maxstreakamount + currentAmount;
                    if(currentstreak>=0) {
                        currentstreak++;
                        if(maxwinstreakamount<=maxstreakamount){
                            maxwinstreakamount = maxstreakamount.toFixed(8) ;
                        }
                    } else {
                        currentstreak = 1;
                        if(maxlossstreakamount>=minstreakamount){
                            maxlossstreakamount = minstreakamount.toFixed(8) ;
                        }
                        minstreakamount = 0;
                    } 
                    if(maxwinstreak<currentstreak){
                        maxwinstreak = currentstreak;
                    }
                } else {
                    minstreakamount = minstreakamount - currentAmount;
                    if(currentstreak<0) {
                        currentstreak--;
                        if(maxlossstreakamount>=minstreakamount){
                            maxlossstreakamount = minstreakamount.toFixed(8) ;
                        }
                    } else {
                        currentstreak = -1;
                        if(maxwinstreakamount<=maxstreakamount){
                            maxwinstreakamount = maxstreakamount.toFixed(8) ;
                        }
                        maxstreakamount = 0;
                    } 
                    if(maxlossstreak>currentstreak){
                        maxlossstreak = currentstreak;
                    }
                }
                $$('bet_current_stats2').setValues({
                    bet_current_stats_current_streak:currentstreak,
                    bet_current_stats_max_win_streak:maxwinstreak,
                    bet_current_stats_max_loss_streak:maxlossstreak,
                    bet_current_stats_max_win_streak_amount:maxwinstreakamount,
                    bet_current_stats_max_loss_streak_amount:maxlossstreakamount,
                    bet_current_stats_max_bet_amount:maxbetamount,
                });
            }
            function setBetToLua(ret, currencyValue){
                currentstreak = $$('bet_current_stats2').getValues().bet_current_stats_current_streak;
                profit = getProfit(ret.info,currencyValue);
                balance = getBalance(ret.info)
                win = getWinStatus(ret);
                currentprofit = getCurrProfit(ret);
                currentroll = getCurrentRoll(ret);
                bets = bets + 1;
                if(getWinStatus(ret)){
                    wins = wins + 1;
                    if(currentLanguage == 'lua') fengari.load('wins='+wins+'\ncurrentstreak='+currentstreak+'\n')();
                } else {
                    losses = losses + 1;
                    if(currentLanguage == 'lua') fengari.load('losses='+losses+'\ncurrentstreak='+currentstreak+'\n')();
                }
                if(currentLanguage == 'lua') fengari.load('win='+ win +'\nbets='+bets+'\ncurrentprofit='+currentprofit+'\ncurrentroll='+currentroll+'\nprofit='+profit+'\nbalance='+balance+'\n')()
            }
            function setChart(ret, count, currencyValue){
                profit = getProfit(ret.info,currencyValue);
                $$("bet_chart").add({xValue: count, yValue: profit});
            }
            //print to html
            (function () {
                let orig = console.log;
                console.log = function (message) {
                    if (typeof message == 'object') {
                    //webix.message(JSON.stringify( message));
                        $$("script_bet_log_board").add({
                            title:'<font size="3" color="green">'+format(new Date())+' '+(JSON && JSON.stringify ? JSON.stringify(message) : message)+'</font>' 
                        },0)
                    } else {
                        $$("script_bet_log_board").add({
                            title:'<font size="3" color="green">'+format(new Date())+' '+message+'</font>' 
                        },0)
                    }
                    orig.apply(console, arguments);
                }
            })();
            (function () {
                let orig = console.error;
                console.error = function (message) {
                    if (typeof message == 'object') {
                        $$("script_bet_log_board").add({
                            title:'<font size="3" color="red">'+format(new Date())+' '+(JSON && JSON.stringify ? JSON.stringify(message) : message)+'</font>' 
                        },0)
                    } else {
                        $$("script_bet_log_board").add({
                            title:'<font size="3" color="red">'+format(new Date())+' '+message+'</font>' 
                        },0)
                    }
                    orig.apply(console, arguments);
                }
            })();
            function focusFunction() {
                if(webix.env.mobile) {
                    let layout = $$("mobile_toolbar").getParentView();
                    layout.hide();
                }
            }
            function onblurFunction() {
                if(webix.env.mobile) {
                    let layout = $$("mobile_toolbar").getParentView();
                    layout.show();
                }
            }
            function expand() {
                let cm = $$("script_bet_coding_board")._editor;
                cm.setOption("fullScreen", !cm.getOption("fullScreen"));
            }
            function changeMode(language) {
                currentLanguage  = language;
                let cm = $$("script_bet_coding_board")._editor;
                cm.setOption("mode", language);
                loadScript();
            }
            function stop(){
                isloop = false;
            }
            function  evalScript(strScript){
                let dynamicStr = document.createElement ("script");
                dynamicStr.type= "text/javascript";
                dynamicStr.text= strScript;
                document.getElementsByTagName ("head")[0].appendChild(dynamicStr);
            }
            function currentCodeChanged() {
                let cm = $$("script_bet_coding_board")._editor;
                return cm.execCommand("isChange");
            }
    script(src=site)
